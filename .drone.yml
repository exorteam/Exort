kind: pipeline
name: exort

steps:
- name: build
  image: thomasf/drone-mvn
  volumes:
  - name: cache
    path: /root/.m2
  - name: targetfile
    path: /drone/src/auth/target
  commands:
  - cd ./auth
  - mvn package 

- name: docker
  image: plugins/docker
  volumes:
  - name: targetfile
    path: ./auth/target
  settings: 
    username:
        from_secret: aliyun-docker-usr
    password:
        from_secret: aliyun-docker-pwd
    repo: registry.cn-shanghai.aliyuncs.com/exort/auth
    registry: registry.cn-shanghai.aliyuncs.com
    dockerfile: ./auth/Dockerfile
    tags:
        - latest

trigger:
  branch:
  - auth
  
volumes:
  - name: cache
    host:
      path: /home/ubuntu/repo
  - name: targetfile
    host:
      path: /home/ubuntu/targetfile
